<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Lady Blackbird</title>
    <meta name="description" content="playaids for Lady Blackbird built with Javascript">
    <meta name="author" content="brushmen">

    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/common.css">

    <!-- custom CSS -->
    <style>
    body {
        background-color: rgb(220, 217, 205);
    }

    select {
        background-color: Gainsboro !important;
    }

    #c1, #c2, #c3, #c4, #c5, #c6 {
        position: relative;
    }

    #c1 { border: 1px solid red; }
    #c2 { border: 1px solid green; }
    #c3 { border: 1px solid blue; }
    #c4 { border: 1px solid aliceblue; }
    #c5 { border: 1px solid black; }

    input[name=character] {
        font-weight: bolder;
    }
    input[name=player], textarea[name=notes] {
        font-size: 0.7em;
    }
    input[name=player] {
        color: #cccccc;
        text-align: center;
    }
    textarea[name=notes] {
        line-height: 1.1em;
        min-height: 190px;
    }

    input[name=pool] {
        width: 2.5em !important;
    }
    button[name=rolldice] {
        width: 1.8em !important;
        margin-right: 0.2em !important;
    }
    div[name=dicepool], div[name=xp] {
        font-weight: bolder;
    }
    #owlconditions p {
        margin: 0.5em;
        font-size: 0.8em;
    }

    input[type=checkbox] {
      /* Double-sized Checkboxes */
      -ms-transform: scale(2); /* IE */
      -moz-transform: scale(2); /* FF */
      -webkit-transform: scale(2); /* Safari and Chrome */
      -o-transform: scale(2); /* Opera */
      padding: 10px;
      margin: 0 10px;
    }

    [name=conditions] {
        margin: 10px 0;
    }

    div[name=traits], div[name=keys], div[name=secrets] {
        position: absolute;
        top: 0;
        right: 0;
        z-index: 2;
        visibility: hidden;
        max-width: 500px;
        max-height: 500px;
        overflow: auto;
    }

    #commonArea {
        width: 6em;
    }

    #owlStat {
        height: 340px;
    }

    .traits, .keys, .secrets {
        font-size: 0.8em;
    }
    .traits div, .keys div, .secrets div {
        margin-bottom: 1em;
    }

    .tags {
        font-style: italic;
    }
    .traits div .btn-link {
        display: inline !important;
        padding: 0;
        margin: 0;
    }

    .keys div .btn-link {
        display: inline !important;
        padding: 0 !important;
        margin: 0 !important;
        color: red !important;
    }

    #resultArea {
        text-align: center;
        width: 100%;
        padding: 2px 20px;
        font-size: 1.2em;
        border: 1px solid black;
    }

    #chatSection {
        width: 9em;
        height: 250px;
        overflow-y: scroll;
    }

    .selected {
        pointer-events: none;
        border: 2px solid orange;
        color: orange;
    }
    </style>
</head>
<body>
    <!-- hovering panels -->
    <div id="rulesbox" style="display: none" class="card shadow">
        <h6 id="rulesboxHeader" class="card-header move"><p>John Harper's <a href="http://ladyblackbird.org" target="new">Lady Blackbird</a></h6>
        <div class="topRightClick" onclick="$('#rulesbox').hide();">hide</div>
        <div class="container card-body">
            <select id="infolist" name="infolist" class="form-control form-control-sm">
                <option value="about" selected="selected">about Lady Blackbird</option>
                <option value="diceroll">dice rolling</option>
                <option value="keysandxp">keys and xp</option>
                <option value="advancements">advancements</option>
                <option value="refreshment">refreshment</option>
                <option value="questions">starter questions</option>
                <option value="theowl">the owl</option>
                <option value="theworlds">the worlds</option>
                <option value="namelists">name lists</option>
            </select>
            <div id="infoArea" class="row">
                <em>
                    <p>Lady Blackbird is on the run from an arranged marriage to Count Carlowe. She hired a smuggler skyship, The Owl, to take her from her palace on the Imperial world of Ilysium to the far reaches of the Remnants, so she could be with her once secret lover, the pirate king Uriah Flint.</p>
                    <p>However‚ÄîJust before reaching the halfway point of Haven, The Owl was pursued and captured by the Imperial cruiser Hand of Sorrow, under charges of flying a false flag.</p>
                    <p>Even now Lady Blackbird, her bodyguard, and the crew of The Owl are detained in the brig, while the commander of the cruiser, Captain Hollas, runs the smuggler ship‚Äôs registry over the wireless. It‚Äôs only a matter of time before they discover the outstanding warrants and learn that The Owl is owned by none other than the infamous outcast Cyrus Vance.</p>
                    <p>How will lady blackbird and the others escape the hand of sorrow?</p>
                    <p>What dangers lie in their path?</p>
                    <p>Will they be able to find the secret lair of the pirate king? If they do, will uriah flint accept lady blackbird as his bride? By the time they get there, will she want him to?</p>
                </em>
            </div>
        </div>
    </div>
    <div id="loadbox" style="display: none" class="card shadow">
        <h5 class="card-header">load JSON content</h5>
        <div class="topRightClick" onclick="$('#loadbox').hide();">hide</div>
        <textarea id="loadboxjson" placeholder="JSON only"></textarea>
        <button type="submit" class="btn btn-sm btn-warning">load</button>
    </div>
    <div id="imageviewbox" style="display: none" class="card shadow">
        <h6 id="imageviewboxHeader" class="card-header move">image view</h6>
        <div class="topRightClick" onclick="$('#imageviewbox').hide();">hide</div>
        <img src="" id="imageviewImage" alt="an image" title="an image to show the group" />
        <div class="container-fluid input-group p-0">
            <input type="text" id="imageviewImageURL" class="form-control form-control-sm" placeholder="URL of image" />
            <button class="btn btn-sm btn-info" onclick="loadImage('imageviewImage', 'imageviewImageURL');">load image</button>
        </div>
    </div>
    <div id="mapviewbox" style="display: none" class="card">
        <h5 id="mapviewboxHeader" class="card-header move">map</h5>
        <div class="topRightClick" onclick="$('#mapviewbox').hide();">hide</div>
        <img src="" id="mapviewImage" alt="map view image" title="" />
        <div class="container-fluid input-group p-0">
            <input type="text" id="mapviewImageURL" class="form-control form-control-sm" placeholder="URL of image" />
            <button class="btn btn-sm btn-info" onclick="loadImage('mapviewImage', 'mapviewImageURL');">load image</button>
        </div>
    </div>
    <!-- display:none will remove the element's width, so for p5 canvas to get the container's width, hiding it can only make it invisible, not by removing it from DOM -->
    <div id="scratchpadArea" style="visibility: hidden" class="card">
        <h5 id="scratchpadAreaHeader" class="card-header move">scratchpad (nothing here is saved!)</h5>
        <div class="topRightClick" onclick="toggleScratchpad();">hide</div>
        <div class="card-body">
            <div class="row">
                <div class="col-1 p-0">
                    <div id="strokeOptions" class="btn-group-vertical">
                        <button id="clear-btn" class="btn btn-sm btn-outline-dark" title="clear">üóë</button>
                        <button id="erase-btn" class="btn btn-sm btn-outline-dark" title="erase">üßº</button>
                        <button id="black-btn" class="btn btn-sm btn-outline-dark" title="black">‚úé</button>
                        <button id="red-btn" class="btn btn-sm btn-outline-dark" title="red">‚úé</button>
                        <button id="green-btn" class="btn btn-sm btn-outline-dark" title="green">‚úé</button>
                        <button id="blue-btn" class="btn btn-sm btn-outline-dark" title="blue">‚úé</button>
                        <button id="brown-btn" class="btn btn-sm btn-outline-dark" title="brown">‚úé</button>
                    </div>
                </div>
                <div id="whiteboard" class="col-11 p-0"></div>
            </div>
        </div>
    </div>

    <!-- right side menu buttons, leave space in between for TogetherJS bar. add/remove buttons as applicable -->
    <div id="menubuttons" class="btn-group-vertical shadow">
        <!-- <button id="togetherjsbutton" class="btn btn-sm btn-outline-dark" onclick="TogetherJS(this); return false;" title="start TogetherJS to collaborate with friends">üë•</button> -->
        <button id="rulesbutton" class="btn btn-sm btn-outline-dark" onclick="showRules(); return false;" title="show game rules">üìñ</button>
        <button id="loadjsonbutton" class="btn btn-sm btn-outline-dark" onclick="loadGame(); return false;" title="load a JSON file of the game content">üìÇ</button>
        <button id="savejsonbutton" class="btn btn-sm btn-outline-dark" onclick="saveGame(); return false;" title="save current game content to a JSON file to download">üíæ</button>
        <button id="imagebutton" class="btn btn-sm btn-outline-dark" onclick="$('#imageviewbox').toggle(); return false;" title="show an image">üñº</button>
        <button id="mapbutton" class="btn btn-sm btn-outline-dark" onclick="$('#mapviewbox').toggle(); return false;" title="show a map">üó∫</button>
        <button id="drawbutton" class="btn btn-sm btn-outline-dark" onclick="toggleScratchpad(); return false;" title="draw something">üé®</button>
        <button id="xcardbutton" class="btn btn-sm btn-outline-dark" onclick="safetyTool('x-card'); return false;" title="X-Card: request that a story detail be removed from the game">‚ùé</button>
        <button id="clearallbutton" class="btn btn-sm btn-outline-dark shadow" onclick="newGame(); return false;" title="clear fields, start over">üóë</button>
    </div>


    <!-- main content -->
    <div id="playArea" class="container-fluid">
        <div class="row full-height">
            <div class="col">
                <div class="row">

                    <div id="c1" class="col-2 full-height">
                        <div class="hideClick" onclick="$('#p1Area').toggle();">üëÅ</div>
                        <div id="p1Area" class="row">
                            <select id="role1" name="role" class="form-control form-control-sm">
                                <option value="" disabled="disabled" selected="selected">I am...</option>
                                <option value="noble" title="An Imperial noble, in disguise, escaping an arranged marriage so she can be with her lover">The Noble</option>
                                <option value="bodyguard" title="Former pit-fighter and bodyguard to Lady Blackbird">The Bodyguard</option>
                                <option value="outcast" title="An ex-Imperial soldier turned smuggler and soldier-of-fortune, Captain of The Owl">The Outcast</option>
                                <option value="mechanic" title="A burglar and petty sorcerer, first mate and mechanic of The Owl">The Mechanic</option>
                                <option value="pilot" title="A goblin sky-sailor and pilot of The Owl">The Pilot</option>
                            </select>

                            <div class="container-fluid">
                                <div class="row">
                                    <div id="profile1" name="profile">
                                        <input type="text" id="player1" name="player" class="form-control form-control-sm text-muted" placeholder="player" />

                                        <input type="text" id="character1" name="character" class="form-control form-control-sm text-primary" placeholder="character" />
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-6 portrait p-0">
                                                    <img src="" id="portrait1" data-toggle="tooltip" alt="image for character 1" onclick="portraitURL(1);" title="" />
                                                </div>
                                                <div class="col-6 p-0">
                                                    <div id="attributes1" name="attributes" class="input-group btn-group-vertical">
                                                        <button id="traitsButton1" name="traitsButton" class="btn btn-sm btn-outline-dark">traits üé≠</button>
                                                        <button id="keysButton1" name="keysButton" class="btn btn-sm btn-outline-dark">keys üóù</button>
                                                        <button id="secretsButton1" name="secretsButton" class="btn btn-sm btn-outline-dark">secrets ‚ç∞</button>
                                                    </div>
                                                </div>

                                                <!-- hidden traits, keys, secrets detail storage -->

                                                <div id="traits1" name="traits"></div>
                                                <div id="keys1" name="keys"></div>
                                                <div id="secrets1" name="secrets"></div>

                                            </div>
                                        </div>
                                        <textarea id="notes1" name="notes" class="form-control form-control-sm" placeholder="notes"></textarea>
                                    </div>

                                    <div id="dicepoolGroup1" name="dicepoolGroup" class="input-group input-group-sm">
                                        <input type="text" id="pool1" name="pool" class="form-control form-control-sm" placeholder="pool" title="dice to roll to take on a challenge" value="1" />
                                        <button id="rolldice1" name="rolldice" class="form-control btn btn-sm btn-outline-dark" title="roll dice">üé≤</button>
                                        <button type="button" id="plusPoolDice1" name="plusPoolDice" class="form-control btn btn-sm btn-primary">+</button>
                                        <button id="dicepool1" name="dicepool" class="form-control btn btn-sm btn-outline-dark text-primary">7</button>
                                        <button type="button" id="minusPoolDice1" name="minusPoolDice" class="form-control btn btn-sm btn-primary">-</button>
                                    </div>

                                    <div id="xpGroup1" name="xpGroup" class="input-group input-group-sm">
                                        <label id="xpLabel1" name="xpLabel" class="form-control form-control-sm input-group-text">XP</label>
                                        <button type="button" id="plusXP1" name="plusXP" class="form-control btn btn-sm btn-success">+</button>
                                        <button id="xp1" name="xp" class="form-control btn btn-sm btn-outline-dark text-success">0</button>
                                        <button type="button" id="minusXP1" name="minusXP" class="form-control btn btn-sm btn-success">-</button>
                                    </div>

                                    <div id="conditions1" name="conditions" class="row">
                                        <div class="col-2"><span title="tired" class="bg-light">üò¥<input type="checkbox" id="tired1" name="tired" /></span></div>
                                        <div class="col-2"><span title="angry">üò†<input type="checkbox" id="angry1" name="angry" /></span></div>
                                        <div class="col-2"><span title="trapped" class="bg-secondary">üò¨<input type="checkbox" id="trapped1" name="trapped" /></span></div>
                                        <div class="col-2"><span title="injured" class="bg-danger text-light">ü§ï<input type="checkbox" id="injured1" name="injured"/></span></div>
                                        <div class="col-2"><span title="dead" class="bg-dark text-light">üíÄ<input type="checkbox" id="dead1" name="dead" /></span></div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                    <div id="c2" class="col-2 full-height">
                        <div class="hideClick" onclick="$('#p2Area').toggle();">üëÅ</div>
                        <div id="p2Area" class="row">
                            <select id="role2" name="role" class="form-control form-control-sm">
                                <option value="" disabled="disabled" selected="selected">I am...</option>
                                <option value="noble" title="An Imperial noble, in disguise, escaping an arranged marriage so she can be with her lover">The Noble</option>
                                <option value="bodyguard" title="Former pit-fighter and bodyguard to Lady Blackbird">The Bodyguard</option>
                                <option value="outcast" title="An ex-Imperial soldier turned smuggler and soldier-of-fortune, Captain of The Owl">The Outcast</option>
                                <option value="mechanic" title="A burglar and petty sorcerer, first mate and mechanic of The Owl">The Mechanic</option>
                                <option value="pilot" title="A goblin sky-sailor and pilot of The Owl">The Pilot</option>
                            </select>

                            <div class="container-fluid">
                                <div class="row">
                                    <div id="profile2" name="profile">
                                        <input type="text" id="player2" name="player" class="form-control form-control-sm text-muted" placeholder="player" />

                                        <input type="text" id="character2" name="character" class="form-control form-control-sm text-primary" placeholder="character" />
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-6 portrait p-0">
                                                    <img src="" id="portrait2" data-toggle="tooltip" alt="image for character 2" onclick="portraitURL(2);" title="" />
                                                </div>
                                                <div class="col-6 p-0">
                                                    <div id="attributes2" name="attributes" class="input-group btn-group-vertical">
                                                        <button id="traitsButton2" name="traitsButton" class="btn btn-sm btn-outline-dark">traits üé≠</button>
                                                        <button id="keysButton2" name="keysButton" class="btn btn-sm btn-outline-dark">keys üóù</button>
                                                        <button id="secretsButton2" name="secretsButton" class="btn btn-sm btn-outline-dark">secrets ‚ç∞</button>
                                                    </div>
                                                </div>

                                                <!-- hidden traits, keys, secrets detail storage -->

                                                <div id="traits2" name="traits"></div>
                                                <div id="keys2" name="keys"></div>
                                                <div id="secrets2" name="secrets"></div>

                                            </div>
                                        </div>
                                        <textarea id="notes2" name="notes" class="form-control form-control-sm" placeholder="notes"></textarea>
                                    </div>

                                    <div id="dicepoolGroup2" name="dicepoolGroup" class="input-group input-group-sm">
                                        <input type="text" id="pool2" name="pool" class="form-control form-control-sm" placeholder="pool" title="dice to roll to take on a challenge" value="1" />
                                        <button id="rolldice2" name="rolldice" class="form-control btn btn-sm btn-outline-dark" title="roll dice">üé≤</button>
                                        <button type="button" id="plusPoolDice2" name="plusPoolDice" class="form-control btn btn-sm btn-primary">+</button>
                                        <button id="dicepool2" name="dicepool" class="form-control btn btn-sm btn-outline-dark text-primary">7</button>
                                        <button type="button" id="minusPoolDice2" name="minusPoolDice" class="form-control btn btn-sm btn-primary">-</button>
                                    </div>

                                    <div id="xpGroup2" name="xpGroup" class="input-group input-group-sm">
                                        <label id="xpLabel2" name="xpLabel" class="form-control form-control-sm input-group-text">XP</label>
                                        <button type="button" id="plusXP2" name="plusXP" class="form-control btn btn-sm btn-success">+</button>
                                        <button id="xp2" name="xp" class="form-control btn btn-sm btn-outline-dark text-success">0</button>
                                        <button type="button" id="minusXP2" name="minusXP" class="form-control btn btn-sm btn-success">-</button>
                                    </div>

                                    <div id="conditions2" name="conditions" class="row">
                                        <div class="col-2"><span title="tired" class="bg-light">üò¥<input type="checkbox" id="tired2" name="tired" /></span></div>
                                        <div class="col-2"><span title="angry">üò†<input type="checkbox" id="angry2" name="angry" /></span></div>
                                        <div class="col-2"><span title="trapped" class="bg-secondary">üò¨<input type="checkbox" id="trapped2" name="trapped" /></span></div>
                                        <div class="col-2"><span title="injured" class="bg-danger text-light">ü§ï<input type="checkbox" id="injured2" name="injured"/></span></div>
                                        <div class="col-2"><span title="dead" class="bg-dark text-light">üíÄ<input type="checkbox" id="dead2" name="dead" /></span></div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                    <div id="c3" class="col-2 full-height">
                        <div class="hideClick" onclick="$('#p3Area').toggle();">üëÅ</div>
                        <div id="p3Area" class="row">
                            <select id="role3" name="role" class="form-control form-control-sm">
                                <option value="" disabled="disabled" selected="selected">I am...</option>
                                <option value="noble" title="An Imperial noble, in disguise, escaping an arranged marriage so she can be with her lover">The Noble</option>
                                <option value="bodyguard" title="Former pit-fighter and bodyguard to Lady Blackbird">The Bodyguard</option>
                                <option value="outcast" title="An ex-Imperial soldier turned smuggler and soldier-of-fortune, Captain of The Owl">The Outcast</option>
                                <option value="mechanic" title="A burglar and petty sorcerer, first mate and mechanic of The Owl">The Mechanic</option>
                                <option value="pilot" title="A goblin sky-sailor and pilot of The Owl">The Pilot</option>
                            </select>

                            <div class="container-fluid">
                                <div class="row">
                                    <div id="profile3" name="profile">
                                        <input type="text" id="player3" name="player" class="form-control form-control-sm text-muted" placeholder="player" />

                                        <input type="text" id="character3" name="character" class="form-control form-control-sm text-primary" placeholder="character" />
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-6 portrait p-0">
                                                    <img src="" id="portrait3" data-toggle="tooltip" alt="image for character 3" onclick="portraitURL(3);" title="" />
                                                </div>
                                                <div class="col-6 p-0">
                                                    <div id="attributes3" name="attributes" class="input-group btn-group-vertical">
                                                        <button id="traitsButton3" name="traitsButton" class="btn btn-sm btn-outline-dark">traits üé≠</button>
                                                        <button id="keysButton3" name="keysButton" class="btn btn-sm btn-outline-dark">keys üóù</button>
                                                        <button id="secretsButton3" name="secretsButton" class="btn btn-sm btn-outline-dark">secrets ‚ç∞</button>
                                                    </div>
                                                </div>

                                                <!-- hidden traits, keys, secrets detail storage -->

                                                <div id="traits3" name="traits"></div>
                                                <div id="keys3" name="keys"></div>
                                                <div id="secrets3" name="secrets"></div>

                                            </div>
                                        </div>
                                        <textarea id="notes3" name="notes" class="form-control form-control-sm" placeholder="notes"></textarea>
                                    </div>

                                    <div id="dicepoolGroup3" name="dicepoolGroup" class="input-group input-group-sm">
                                        <input type="text" id="pool3" name="pool" class="form-control form-control-sm" placeholder="pool" title="dice to roll to take on a challenge" value="1" />
                                        <button id="rolldice3" name="rolldice" class="form-control btn btn-sm btn-outline-dark" title="roll dice">üé≤</button>
                                        <button type="button" id="plusPoolDice3" name="plusPoolDice" class="form-control btn btn-sm btn-primary">+</button>
                                        <button id="dicepool3" name="dicepool" class="form-control btn btn-sm btn-outline-dark text-primary">7</button>
                                        <button type="button" id="minusPoolDice3" name="minusPoolDice" class="form-control btn btn-sm btn-primary">-</button>
                                    </div>

                                    <div id="xpGroup3" name="xpGroup" class="input-group input-group-sm">
                                        <label id="xpLabel3" name="xpLabel" class="form-control form-control-sm input-group-text">XP</label>
                                        <button type="button" id="plusXP3" name="plusXP" class="form-control btn btn-sm btn-success">+</button>
                                        <button id="xp3" name="xp" class="form-control btn btn-sm btn-outline-dark text-success">0</button>
                                        <button type="button" id="minusXP3" name="minusXP" class="form-control btn btn-sm btn-success">-</button>
                                    </div>

                                    <div id="conditions3" name="conditions" class="row">
                                        <div class="col-2"><span title="tired" class="bg-light">üò¥<input type="checkbox" id="tired3" name="tired" /></span></div>
                                        <div class="col-2"><span title="angry">üò†<input type="checkbox" id="angry3" name="angry" /></span></div>
                                        <div class="col-2"><span title="trapped" class="bg-secondary">üò¨<input type="checkbox" id="trapped3" name="trapped" /></span></div>
                                        <div class="col-2"><span title="injured" class="bg-danger text-light">ü§ï<input type="checkbox" id="injured3" name="injured"/></span></div>
                                        <div class="col-2"><span title="dead" class="bg-dark text-light">üíÄ<input type="checkbox" id="dead3" name="dead" /></span></div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                    <div id="c4" class="col-2 full-height">
                        <div class="hideClick" onclick="$('#p4Area').toggle();">üëÅ</div>
                        <div id="p4Area" class="row">
                            <select id="role4" name="role" class="form-control form-control-sm">
                                <option value="" disabled="disabled" selected="selected">I am...</option>
                                <option value="noble" title="An Imperial noble, in disguise, escaping an arranged marriage so she can be with her lover">The Noble</option>
                                <option value="bodyguard" title="Former pit-fighter and bodyguard to Lady Blackbird">The Bodyguard</option>
                                <option value="outcast" title="An ex-Imperial soldier turned smuggler and soldier-of-fortune, Captain of The Owl">The Outcast</option>
                                <option value="mechanic" title="A burglar and petty sorcerer, first mate and mechanic of The Owl">The Mechanic</option>
                                <option value="pilot" title="A goblin sky-sailor and pilot of The Owl">The Pilot</option>
                            </select>

                            <div class="container-fluid">
                                <div class="row">
                                    <div id="profile4" name="profile">
                                        <input type="text" id="player4" name="player" class="form-control form-control-sm text-muted" placeholder="player" />

                                        <input type="text" id="character4" name="character" class="form-control form-control-sm text-primary" placeholder="character" />
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-6 portrait p-0">
                                                    <img src="" id="portrait4" data-toggle="tooltip" alt="image for character 4" onclick="portraitURL(4);" title="" />
                                                </div>
                                                <div class="col-6 p-0">
                                                    <div id="attributes4" name="attributes" class="input-group btn-group-vertical">
                                                        <button id="traitsButton4" name="traitsButton" class="btn btn-sm btn-outline-dark">traits üé≠</button>
                                                        <button id="keysButton4" name="keysButton" class="btn btn-sm btn-outline-dark">keys üóù</button>
                                                        <button id="secretsButton4" name="secretsButton" class="btn btn-sm btn-outline-dark">secrets ‚ç∞</button>
                                                    </div>
                                                </div>

                                                <!-- hidden traits, keys, secrets detail storage -->

                                                <div id="traits4" name="traits"></div>
                                                <div id="keys4" name="keys"></div>
                                                <div id="secrets4" name="secrets"></div>

                                            </div>
                                        </div>
                                        <textarea id="notes4" name="notes" class="form-control form-control-sm" placeholder="notes"></textarea>
                                    </div>

                                    <div id="dicepoolGroup4" name="dicepoolGroup" class="input-group input-group-sm">
                                        <input type="text" id="pool4" name="pool" class="form-control form-control-sm" placeholder="pool" title="dice to roll to take on a challenge" value="1" />
                                        <button id="rolldice4" name="rolldice" class="form-control btn btn-sm btn-outline-dark" title="roll dice">üé≤</button>
                                        <button type="button" id="plusPoolDice4" name="plusPoolDice" class="form-control btn btn-sm btn-primary">+</button>
                                        <button id="dicepool4" name="dicepool" class="form-control btn btn-sm btn-outline-dark text-primary">7</button>
                                        <button type="button" id="minusPoolDice4" name="minusPoolDice" class="form-control btn btn-sm btn-primary">-</button>
                                    </div>

                                    <div id="xpGroup4" name="xpGroup" class="input-group input-group-sm">
                                        <label id="xpLabel4" name="xpLabel" class="form-control form-control-sm input-group-text">XP</label>
                                        <button type="button" id="plusXP4" name="plusXP" class="form-control btn btn-sm btn-success">+</button>
                                        <button id="xp4" name="xp" class="form-control btn btn-sm btn-outline-dark text-success">0</button>
                                        <button type="button" id="minusXP4" name="minusXP" class="form-control btn btn-sm btn-success">-</button>
                                    </div>

                                    <div id="conditions4" name="conditions" class="row">
                                        <div class="col-2"><span title="tired" class="bg-light">üò¥<input type="checkbox" id="tired4" name="tired" /></span></div>
                                        <div class="col-2"><span title="angry">üò†<input type="checkbox" id="angry4" name="angry" /></span></div>
                                        <div class="col-2"><span title="trapped" class="bg-secondary">üò¨<input type="checkbox" id="trapped4" name="trapped" /></span></div>
                                        <div class="col-2"><span title="injured" class="bg-danger text-light">ü§ï<input type="checkbox" id="injured4" name="injured"/></span></div>
                                        <div class="col-2"><span title="dead" class="bg-dark text-light">üíÄ<input type="checkbox" id="dead4" name="dead" /></span></div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                    <div id="c5" class="col-2 full-height">
                        <div class="hideClick" onclick="$('#p5Area').toggle();">üëÅ</div>
                        <div id="p5Area" class="row">
                            <select id="role5" name="role" class="form-control form-control-sm">
                                <option value="" disabled="disabled" selected="selected">I am...</option>
                                <option value="noble" title="An Imperial noble, in disguise, escaping an arranged marriage so she can be with her lover">The Noble</option>
                                <option value="bodyguard" title="Former pit-fighter and bodyguard to Lady Blackbird">The Bodyguard</option>
                                <option value="outcast" title="An ex-Imperial soldier turned smuggler and soldier-of-fortune, Captain of The Owl">The Outcast</option>
                                <option value="mechanic" title="A burglar and petty sorcerer, first mate and mechanic of The Owl">The Mechanic</option>
                                <option value="pilot" title="A goblin sky-sailor and pilot of The Owl">The Pilot</option>
                            </select>

                            <div class="container-fluid">
                                <div class="row">
                                    <div id="profile5" name="profile">
                                        <input type="text" id="player5" name="player" class="form-control form-control-sm text-muted" placeholder="player" />

                                        <input type="text" id="character5" name="character" class="form-control form-control-sm text-primary" placeholder="character" />
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-6 portrait p-0">
                                                    <img src="" id="portrait5" data-toggle="tooltip" alt="image for character 5" onclick="portraitURL(5);" title="" />
                                                </div>
                                                <div class="col-6 p-0">
                                                    <div id="attributes5" name="attributes" class="input-group btn-group-vertical">
                                                        <button id="traitsButton5" name="traitsButton" class="btn btn-sm btn-outline-dark">traits üé≠</button>
                                                        <button id="keysButton5" name="keysButton" class="btn btn-sm btn-outline-dark">keys üóù</button>
                                                        <button id="secretsButton5" name="secretsButton" class="btn btn-sm btn-outline-dark">secrets ‚ç∞</button>
                                                    </div>
                                                </div>

                                                <!-- hidden traits, keys, secrets detail storage -->

                                                <div id="traits5" name="traits"></div>
                                                <div id="keys5" name="keys"></div>
                                                <div id="secrets5" name="secrets"></div>

                                            </div>
                                        </div>
                                        <textarea id="notes5" name="notes" class="form-control form-control-sm" placeholder="notes"></textarea>
                                    </div>

                                    <div id="dicepoolGroup5" name="dicepoolGroup" class="input-group input-group-sm">
                                        <input type="text" id="pool5" name="pool" class="form-control form-control-sm" placeholder="pool" title="dice to roll to take on a challenge" value="1" />
                                        <button id="rolldice5" name="rolldice" class="form-control btn btn-sm btn-outline-dark" title="roll dice">üé≤</button>
                                        <button type="button" id="plusPoolDice5" name="plusPoolDice" class="form-control btn btn-sm btn-primary">+</button>
                                        <button id="dicepool5" name="dicepool" class="form-control btn btn-sm btn-outline-dark text-primary">7</button>
                                        <button type="button" id="minusPoolDice5" name="minusPoolDice" class="form-control btn btn-sm btn-primary">-</button>
                                    </div>

                                    <div id="xpGroup5" name="xpGroup" class="input-group input-group-sm">
                                        <label id="xpLabel5" name="xpLabel" class="form-control form-control-sm input-group-text">XP</label>
                                        <button type="button" id="plusXP5" name="plusXP" class="form-control btn btn-sm btn-success">+</button>
                                        <button id="xp5" name="xp" class="form-control btn btn-sm btn-outline-dark text-success">0</button>
                                        <button type="button" id="minusXP5" name="minusXP" class="form-control btn btn-sm btn-success">-</button>
                                    </div>

                                    <div id="conditions5" name="conditions" class="row">
                                        <div class="col-2"><span title="tired" class="bg-light">üò¥<input type="checkbox" id="tired5" name="tired" /></span></div>
                                        <div class="col-2"><span title="angry">üò†<input type="checkbox" id="angry5" name="angry" /></span></div>
                                        <div class="col-2"><span title="trapped" class="bg-secondary">üò¨<input type="checkbox" id="trapped5" name="trapped" /></span></div>
                                        <div class="col-2"><span title="injured" class="bg-danger text-light">ü§ï<input type="checkbox" id="injured5" name="injured"/></span></div>
                                        <div class="col-2"><span title="dead" class="bg-dark text-light">üíÄ<input type="checkbox" id="dead5" name="dead" /></span></div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>

                    <div id="c6" class="col-2">
                        <div id="commonArea" class="row-fluid">
                            <div id="owlStat">
                                <h5>The Owl</h5>
                                <div id="owlconditions" name="owlconditions" class="row-fluid">
                                    <p>ü¶â needs...</p>
                                    <p><span title="fuel">üíß <input type="checkbox" id="needFuel" name="needFuel" /></span></p>
                                    <p><span title="supplies">üçï <input type="checkbox" id="needSupplies" name="needSupplies" /></span></p>
                                    <p><span title="repairs">üîß <input type="checkbox" id="needRepairs" name="needRepairs" /></span></p>
                                    <p><span title="speed">üöÄ <input type="checkbox" id="needSpeed" name="needSpeed" /></span></p>
                                </div>
                            </div>

                            <div id="chatArea" class="row">
                                <div id="resultArea">rolls</div>

                                <div class="row">
                                    <form id="messageForm" class="container">
                                        <div id="chatSection">
                                            <!-- the chatSection has a set height
                                                but the chat obj has a dynamically
                                                changing height, otherwise scroll-to-bottom
                                                won't work -->
                                            <div class="chat" id="chat"></div>
                                        </div>
                                        <div class="input-group">
                                            <input type="text" class="form-control form-control-sm width100" id="message" placeholder="chat" />
                                            <span class="input-group-btn">
                                                <input type="submit" class="form-control-sm btn btn-info btn-sm" value="send" />
                                            </span>
                                        </div>
                                    </form>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap template script includes -->
    <!-- <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="/js/common.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="/js/common.js"></script>

    <!-- Javascript code -->
    <script>
        var infotext = {
            'about':
                '<p>Lady Blackbird is on the run from an arranged marriage to Count Carlowe. She hired a smuggler skyship, The Owl, to take her from her palace on the Imperial world of Ilysium to the far reaches of the Remnants, so she could be with her once secret lover, the pirate king Uriah Flint.</p><p>However‚ÄîJust before reaching the halfway point of Haven, The Owl was pursued and captured by the Imperial cruiser Hand of Sorrow, under charges of flying a false flag.</p><p>Even now Lady Blackbird, her bodyguard, and the crew of The Owl are detained in the brig, while the commander of the cruiser, Captain Hollas, runs the smuggler ship‚Äôs registry over the wireless. It‚Äôs only a matter of time before they discover the outstanding warrants and learn that The Owl is owned by none other than the infamous outcast Cyrus Vance.</p><p>How will lady blackbird and the others escape the hand of sorrow?</p><p>What dangers lie in their path?</p><p>Will they be able to find the secret lair of the pirate king? If they do, will uriah flint accept lady blackbird as his bride? By the time they get there, will she want him to?</p>',
            'diceroll':
                "<p>When you try to overcome an obstacle, you roll dice. Follow these steps to determine how many dice you get to roll.</p><p><strong>TRY</strong>: Start with one die just for trying.</p> <p><strong>TRAIT</strong>: Select one trait that applies, add a die for that.</p><p><strong>TAGS</strong>: If that trait has any tags that apply, add another die for each filled circle on that tag. Tags with empty circles cannot be used until you unlock them with experience. Some tags are grouped in a box; you can use only one tag within that box per roll.</p><p><strong>POOL</strong>: Finally, add any number of dice from your personal <strong>dice pool</strong> (start with 7 for a max of 7). Other character(s) can <strong>help</strong> if it can be narratively justified.</p><p>Roll all the dice you‚Äôve gathered. Each <strong>4, 5 or 6</strong> (or each x if you‚Äôre using 50/50 dice) is a hit. Each 1, 2 or 3 (or each blank) is a miss. You need hits equal to the difficulty level (easy: 2, difficult: 3, challenging: 4, extreme: 5, etc.) to succeed.</p><p><strong>If you succeed</strong>, discard all the dice you rolled (including any pool dice you used). Don‚Äôt worry, you can get your pool dice back.</p><p><strong>If you fail</strong>, you don‚Äôt yet achieve your goal. But, you get to keep the pool dice you rolled and add another die to your pool (up to your maximum pool size). The GM will escalate the danger of the situation and probably inflict a condition. You might be able to try again.</p><p>The GM may give some obstacles two difficulty levels (typically two steps apart, for example 2 and 4). Getting a number of hits equal to the higher difficulty level allows for a greater success.</p><p>Example: <em>‚ÄúYes, Naomi, you can take down those two guards, the difficulty level is 3. However, if you get 5 hits, then you can clear all the marines out of this section of the ship.‚Äù</em></p><h5>Helping</h5><p>If your character is in a position to help another pc, you can give that player a die from your pool. Say what your character does to help. The outcome of the roll affects both pcs.</p><h5>Conditions</h5><p>When events warrant or especially when you fail a roll, the GM may impose a condition on your character: Injured, Drained, etc. A condition might incease the difficulty level of a roll, or may restrict your choice of action (you can‚Äôt be reasonable if you‚Äôre angry). note: The ‚Äúdead‚Äù condition just means ‚Äúpresumed dead‚Äù unless you say otherwise.</p><h5>PC vs. PC</h5><p>If your character contends with another player character, both players roll against a difficulty level set by the GM. If one player succeeds, that player wins the conflict and discards dice normally. The other player keeps their rolled pool dice and gets another. If both players succeed, no pool dice are discarded or gained, but the GM interrupts the conflict in whatever manner they see fit. If both players fail, they keep their pool dice and get another die, and the GM escalates the situation or introduces a new obstacle.</p>",

            'keysandxp':
                '<p>When you turn a Key, you can take an experience point (XP) or add a die to your pool (up to your pool maximum).</p><p>Spend xp at any time to:<ul><li>1 xp ‚Äî Get a pool die (up to your pool maximum).</li><li>3 xp ‚Äî Unlock a tag on an existing trait.</li><li>5 xp ‚Äî Increase pool maximum by 1 (and get a pool die).</li><li>5 xp ‚Äî Add a new trait with 3 tags.</li><li>5 xp ‚Äî Add a new key you‚Äôve never had before.</li><li>5 xp ‚Äî Add a new secret.</li></ul></p>',

            'refreshment':
                '<p>In between dice rolls, characters can have refreshment scenes with each other. Refreshment scenes are a good way for the characters to show their personalities and develop their relationships with one another. The conversation between characters can happen in the moment, but can also take the form of a flashback.</p><p>After a refreshment scene, each character:</p> <ul><li>Restores their pool back to their maximum pool.</li><li>Removes one condition (if they did something during the scene to deal with the condition).</li><li>Regains the use of their secrets.</li></ul>',

            'advancements':
                '<table border="0"><tr><td><h5>New Traits & Tags</h5></td></tr><tr><td><strong>Reputation</strong><div class="indented tags">Trustworthy, Reliable, Fearless, Reckless, Ruthless, Underhanded, Dangerous, Deadly, Cruel, Unpredictable, Heroic, Honorable, Compassionate</div></p><strong>Crew</strong><div class="indented tags">Gunnery, Aim, Maintenance, Damage Control, Observation, Signals, The Owl, Cargo, Supplies, First Aid, Boarding Action</div><strong>Explorer</strong><div class="indented tags">Curious, Aware, Nimble, Hardy, Ancient Lore, Languages, Ruins, Monsters, Myths, Maps</div><strong>Investigator</strong><div class="indented tags">Search, Deduction, Perceptive, Seduce, Interrogate, Bribe, Coerce, Contacts, Sneak, Deception, Insight, Logic, Fisticuffs, Pistol</div><strong>Miner</strong><div class="indented tags">Tunnels, Labor, Strong, Pickaxe, Dim Light, Hold Breath, Ores, Resist Cold, Endure</div><strong>Bold</strong><div class="indented tags">Brave, Daring, Heroic, Rescue, Falling, Fire, Reckless, Explosions, Escapes, Outnumbered, Underdog</div><strong>Sky Pirate</strong><div class="indented tags">Vicious, Hack & Slash, Cutlass, Knife, Shooting, Boomstick, Gunner, Boarding Action, Crew, Loot, Capture, Drink, Hardy, Treacherous, Intimidating, Contacts, Underworld</div><strong>Ghostblood</strong><div class="indented tags">Fly, Possess, Insubstantial, Control Technology, Electrical, Dominate, Terrify, Sneak, Overload</div><strong>Stoneblood</strong><div class="indented tags">Harden, Make Heavy, Meld Into Stone, Petrify, Immovable, Mauler, Move Through Stone, Shape Rock, Tough</div><strong>Voidblood</strong><div class="indented tags">Invisibility, Vacuum, Make Weightless, Pass Through, Erase Mind, Counterspell, Disintegrate</div><strong>Dreamblood</strong><div class="indented tags">Sedate, Manipulate Dream, Enter Dream, Hallucination, Blind Fighting, Read Mind</div><strong>Bloodhunter</strong><div class="indented tags">Gather Information, Interrogate, Intimidate, Incognito, Recognize Blood, Reflexes, Authority, Firefights</div></td></tr><tr><td><h5>New Keys</h5></td></tr><tr><td><strong>Key of the Traveler</strong><div class="indented">You love exploring new places. Turn this key when you share an interesting detail about things you‚Äôve seen or when you go somewhere exciting. Buyoff: Pass up the opportunity to see something new.</div><strong>The Key of the Broker</strong><div class="indented">You like to make deals and trade favors. Turn this key when you bargain, make a new contact, or exchange a favor. Buyoff: Cut yourself off from your network of contacts.</div><strong>The Key of the Tinkerer</strong><div class="indented">You just can‚Äôt leave it alone. Turn this key when you modify, improve, repair, or patch some tech. Buyoff: Pass up the opportunity to mess around with technology.</div><strong>The Key of the Pirate</strong><div class="indented">You pillage, raid, and terrorize the Wild Blue. Turn this key when you impress someone with your piratical nature or do something to add to your reputation. Buyoff: Turn over a new leaf and go straight.</div><strong>Key of the Vow</strong><div class="indented">You have a vow of personal behavior that you have sworn not to break. Turn this key when your vow significantly impacts your decisions. Buyoff: Break your vow.</div></td></tr><tr><td><h5>New Secrets</h5><strong>The Secret of the True Course</strong><div class="indented">You know how to navigate the Remnants. Requires: You need to learn the navigation codes from someone who has the secret.</div><strong>The Secret of the Explorer</strong><div class="indented">You‚Äôve been all over the Blue, seen a lot of strange things. Once per refresh, you can re-roll a failure when you‚Äôre dealing with local customs or strange places. Requires: You‚Äôve traveled from one side of the Blue to the other.</div><strong>The Secret of the Sky Song</strong><div class="indented">You know how to call sky squid and can attempt to communicate with them when they appear. Requires: You‚Äôve trained with a master of the Sky Song or have been dream-linked to a sky squid.</div><strong>The Secret of the Shootist</strong><div class="indented">You‚Äôre deadly with a firearm (or two). Once per refresh, you can re-roll a failure when you‚Äôre shooting. Requires: You‚Äôve been in a lot of gunfights or are learning from someone who has.</div><strong>Secret of Experience</strong><div class="indented">Once per refresh, you can use tags from more than one trait when you make a roll. Requires: Experience in a wide variety of dangerous situations.</div></td></tr></table>',

            'questions':
                "<h5>General</h5><ul><li>Can anyone learn magic or do you need to have noble blood?</li><li>What kind of trouble are pirates known to cause?</li><li>Have you ever seen a real sky squid?</li><li>What did you notice about the Hand of Sorrow as you were lead to the brig?</li><li>What game are the guards playing outside the brig right now?</li></ul><h5>Natasha Syri | Lady Blackbird</h5><ul><li>How did you fall in love with Uriah Flint?</li><li>Does anyone in the crew know that you are the Lady Blackbird?</li><li>How did you arrange hiring The Owl?</li><li>What would a very observant person notice about you that would indicate that you‚Äôre a noble?</li><li>How did you become a Master Sorcerer?</li></ul><h5>N. Bishop</h5><ul><li>How did the guards manage to take you alive?</li><li>How did you become Lady Blackbird‚Äôs bodyguard?</li><li>Why did you leave pit-fighting?</li><li>Who was your biggest rival in the pits?</li><li>Have you ever been to Haven or any of the other Free Worlds?</li></ul><h5>C. Vance</h5><ul><li>What do you usually smuggle?</li><li>What did you do to be exiled from the Empire?</li><li>Whose fault is it that you were captured for flying a false flag?</li><li>Who was the pilot before Snargle?</li><li>How do you know Captain Hollas and what did Hollas do to make an enemy of you?</li></ul><h5>K. Arkham</h5><ul><li>What created such a deep bond between you and the Captain?</li><li>You are on a mission to get Lady Blackbird to the Pirate King. What‚Äôs in it for you?</li><li>Who does the Captain like more: you or Snargle?</li><li>What are you hiding in the spot the guards forget to search?</li><li>What weird thing has been going on with The Owl lately?</li></ul><h5>Snargle</h5><ul><li>How are goblins treated by the Empire?</li><li>Who does the Captain like more: you or Kale?</li><li>The Owl is low on fuel. How were you going to pay for it?</li><li>What‚Äôs the most dangerous escape you‚Äôve ever made?</li><li>Is it rare for a goblin to the the pilot of a skyship?</li></ul>",

            'namelists':
                '<p><strong>male</strong>: Abel, Artemis, August, Bram, Charles, Dmitri, Edmund, Eli, Giovanni, Ivan, Jack, Jefferson, Jonas, Kerim, Leo, Logan, Malachi, Mario, Micah, Nahum, Noah, Orlence, Oscar, Samuel, Silas, Thaddeus, Victor, Vlad, Wellington, Wester</p><p><strong>female</strong>: Alice, Ardent, Ashlyn, Brena, Caess, Clare, Daphne, Elena, Eveline, Fiona, Grace, Hannah, Hazel, Hester, Isabel, Jezebel, Josephine, Krista, Leah, Lucile, Lydia, Melinda, Odessa, Rachel, Rosie, Seraphina, Sonya, Sophie, Veronica, Violet</p><p><strong>surnames</strong>: Bell, Bowen, Canter, Carson, Cross, Durrant, Faber, Harwood, Hollas, Hunter, Judge, Kalra, Keel, Lang, Moreau, Morgan, Porter, Pickett, Quinn, Rowe, Sidhu, Soto, Thrush, Torrez, Vakharia, Walker, Winter, Wright, York</p><p><strong>noble houses</strong>: Ash, Blackbird, Firefly, Mooncloud, Nightsong, Snow, Twilight, Whitethorn</p><p><strong>goblins</strong>: Aka, Barra, Boggin, Chank, Edder, Fenya, Gabba, Gimble, Hob, Ippa, Mogga, Molok, Olf, Skitter, Tork, Wamba</p>',

            'theworlds':
                "<h5>Adrift in the Blue</h5><p>The worlds of the Wild Blue float in a sky of breathable gases circling a small, cold star. Scholars believe that the star is made from pure Essence‚Äîthe strange energy that sorcerers channel for their magic. This ‚Äúsolar system‚Äù is much smaller than you might think‚Äîit takes about six weeks to cross from one side to the other on a standard sky ship. Most of the worlds of the Empire are so closely positioned that it takes only a day or two to travel from one to another.</p><h5>The Lower Depths</h5><p>The heavier gases form a dense layer of fog below the ‚Äúsky‚Äù of the Wild Blue. This fog is corrosive‚Äîpeople need to wear gas-masks to breathe and most airship hulls will start to corrode after a single exposure. Pirates and other criminals sometimes use the lower depths to evade Imperial patrols and launch raids from hiding. Unfortunately, the depths are home to sky squid and other monstrous things...</p><h5>Ilysium</h5><p>The capitol world of the Empire, home to the great noble houses. Ilysium is rich and decadent, attended by servants, slaves, and the elite bodyguards of the nobility.</p><h5>Olympia</h5><p>The staging world of the Imperial Sky Fleet. From here, expeditions are launched into the colonial expanse and all across the Wild Blue. Olympia is also home to the finest brewers and distillers in the Empire.</p><h5>Haven</h5><p>The most prominent of the Free Worlds. Here, in the sprawling city hubs, the Trade Union tries to impose some order on the bickering clans and factions of the Free Peoples. Slavery is outlawed here, so many ex-slaves make Haven their home.</p><h5>Nightport</h5><p>Unlike other worlds, Nightport does not rotate, which means one face is always in darkness. It is on this side that pirates and smugglers have built a hidden port city in which to carry out their nefarious dealings. This hive of scum and villainy is a dangerous place, but almost anything may be bought or sold there, including secrets.</p><h5>The Remnants</h5><p>A swirling maelstrom of spinning world-shards. The Remnants are almost impossible to navigate, even for the best airship pilots. It‚Äôs said that pirate royalty keep a secret fortress somewhere deep within the Remnants and only those who know the secret of the true course can ever reach it.</p>",

            'theowl':
                '<p>An old but reliable skyship, outfitted for smuggling.</p><h5>Details & Statistics</h5><p>The Owl was once a Sky Hauler C9 cargo ship but has since been extensively customized by Cyrus and Kale. It has a smaller cargo area and four passenger berths in the reclaimed space. It also has hidden smuggling compartments scattered throughout the vessel.</p><p>The Owl is an old ship, but it can hold its own with more modern vessels thanks to its custom engines and supercharged steam drive. Snargle has also made several unique adjustments to the controls to allow the large ship to maneuver like a much smaller craft.</p><p>Unfortunately, all of these modi cations put a lot of strain on the old girl. Kale keeps the ship running day to day, but when it‚Äôs put under a lot of stress (as it often is) things can go awry‚Äîbroken pipes, vented steam, leaking uids, and worse.</p><p>Still, The Owl is not just a skyship, it‚Äôs a home to its crew. They gather around the beat-up old wooden dinner table in the galley every night and thank the four winds that fortune saw fit to bless them with such a fine craft.</p><table><tr><td><strong>Length</strong>: 48 meters</p><p><strong>Crew</strong>: 2‚Äì3</p><p><strong>Berths</strong>: 6 (2 crew, 4 passenger)</p><p><strong>Cargo Capacity</strong>: 30,000 pounds (6 cargo pods)</p><p><strong>Powerplant</strong>: <ul><li>Tri-Valve Reciprocal Steam Drive</li><li>(2) Twin-Coil Induction Thrusters</li></ul></p><p><strong>Cruise Speed</strong>: 160 knots</p><p><strong>Flank Speed</strong>: 310 knots under boost</p><p><strong>Weapons</strong>: Top-mounted external gun turret</p><p><strong>Wireless</strong>: Midrange Multi-Band with Signal Mask</p><p><strong>Sensors</strong>: <ul><li>Short-Range Sonar</li><li>Atmosphere/Pressure Analyzer</li></ul></p><p><strong>Hull</strong>: Treated to resist corrosion in the lower depths for up to 4 hours.</p></td></tr></table>'
        };

        var room = 'test';
        var gamehandle = 'ladyblackbird';
        var socket = io('/' + gamehandle);

        // prep element effects
        dragElement(document.getElementById("rulesbox"));
        dragElement(document.getElementById("mapviewbox"));
        dragElement(document.getElementById("imageviewbox"));
        dragElement(document.getElementById("scratchpadArea"));

        socket.on('connect', function() {
            // get room name from URL ending, make sure it's not malicious text
            var pathparts = window.location.href.split('?');
            pathparts[1] = sanitize(pathparts[1], 'alphanumeric');
            if (pathparts[1]) {
                room = pathparts[1];
            }
            // console.log('trying to join room ' + room);
            socket.emit("join room", room);
        });

        socket.on('username', function(data) {
            updateUserName(data);
        });
        function updateUserName(user) {
            $('#message').prop('placeholder', user);
        }

        socket.on('user list', function(data) {
            updateUserList(data);
        });
        function updateUserList(list) {
            $('#message').prop('title', list.length + ' user(s): ' + list.join(', '));
        }

        // image related

        socket.on('update image', function(data) {
            updateImage(data.field, data.url);
            save();
        });
        function updateImage(field='currentmap', url) {
            if (field == 'currentmap') {
                $('#mapviewImage').prop('src', url);
            }
            else if (field == 'currentimage') {
                $('#imageviewImage').prop('src', url);
            }
        }
        function loadImage(imgID, imgURLID) {
            var imgURL = $('#' + imgURLID).val();
            $('#' + imgID).prop('src', imgURL);

            if (imgID == 'mapviewImage') {
                socket.emit('update image', {'field': 'currentmap', 'url': imgURL});
            }
            else if (imgID == 'imageviewImage') {
                socket.emit('update image', {'field': 'currentimage', 'url': imgURL});
            }
        }

        socket.on('update portrait', function(data) {
            updatePortrait(data.number, data.url);
            save();
        });
        function updatePortrait(n=0, url) {
            var $e = $('#portrait' + n);
            // hovering tooltip should show the image without distorted porportions
            $e.prop('src', url);
            // force browser to use new image instead of cached image
            $e.tooltip('dispose');
            $e.tooltip({
                html: true,
                placement: 'right',
                title: '<img src="' + url + '" height="500" />'
            });
        }
        function portraitURL(number) {
            var url = prompt("paste in the URL of the image");
            if (url) {
                // try to check if image can be loaded
                var img = new Image();
                img.src = url;
                img.onload = function(){
                    // send info to server
                    socket.emit('update portrait', {'index': (number-1), 'url': url});
                };
                img.onerror = function(){
                    alert("image cannot be loaded");
                }
            }
        }

        $('#messageForm').submit(function(e) {
            var $message = $('#message');
            e.preventDefault();
            socket.emit('chat message', $message.val());
            $message.val('');
        });

        function showRules() {
            $('#rulesbox').toggle();
        }

        function loadGame() {
            $('#loadbox').toggle();
        }
        $('#loadbox button[type=submit]').click(function(e) {
            e.preventDefault();
            // load JSON textfield
            socket.emit('load json', $('#loadboxjson').val());
            // hide the loadbox
            $('#loadbox').hide();
        });
        socket.on('chat message', function(data) {
            var $message = $('#message');
            var message = data.message;
            var user = data.user;
            var type = data.type;
            var html = '';

            if (type == 'updateusername') {
                var names = message.split('|');
                var oldname = names[0];
                var newname = names[1];
                if (oldname != newname) {
                    html = '<div class="well text-muted">(user ' + oldname + ' is now ' + newname + ')</div>';
                }
            }
            else if(type == 'newgame') {
                html = '<div class="well text-muted">' + user + ' started a new game</div>';
            }
            else if (type == 'savegame') {
                var filename = gamehandle + '_' + room + '_' + getTodayString() + '.json';
                // generate the file to download locally
                download(filename, message);
                html = '<div class="well text-muted">' + user + ' is saving game data</div>';
            }
            else if (type == 'loadgame') {
                loadGame();
            }
            else if (type == 'rollresult') {
                updateResult(message);
                html = '<div class="well"><strong>' + user + '</strong> ( ' + message + ' )</div>';
            }
            else { // should be regular chat message
                html = '<div class="well"><strong>' + user + '</strong>: ' + message + '</div>';
            }
            updateChat(html);
        });
        function updateResult(html) {
            if (html) {
                $('#resultArea').html(html);
            }
        }
        function updateChat(html) {
            if (html) {
                var $chat = $('#chat');
                $chat.append(html);
                $('#chatSection').scrollTop($chat.height());
            }
        }

        $('button[name=rolldice]').each(function() {
            $(this).click(function(e) {
                e.preventDefault();
                let i = $(this).prop('id');
                i = i.slice(-1); // last letter of index is the count number
                let v = $('#pool' + i).val();
                var command = 'lb' + v;
                i = parseInt(i) - 1;
                socket.emit('roll dice', {'index': i, 'command': command, 'dice': v});
            });
        });
        socket.on('roll result', function(data) {
            let character = data.character;
            let result = data.result;
            let dice = data.dice;
            updateResult(result);
            // add roll info to chat
            let html = '<div class="well">' + character + ': ' + result + '</div>';
            updateChat(html);
        });

        $('button[name=plusPoolDice], button[name=minusPoolDice], button[name=dicepool], button[name=xp]').each(function() {
            $(this).click(function(e) {
                e.preventDefault();
                let field = $(this).prop('name');
                let i = $(this).prop('id');
                i = i.slice(-1); // last letter of index is the count number
                let pooldice = parseInt($('#dicepool' + i).html());
                let v;
                if (field == 'plusPoolDice') {
                    field = 'dicepool';
                    v = parseInt(pooldice) + 1;
                }
                else if (field == 'minusPoolDice') {
                    field = 'dicepool';
                    v = parseInt(pooldice) - 1;
                }
                else if (field == 'dicepool') {
                    v = "max";
                }
                else if (field == 'xp') {
                    field = 'dicepool';
                    v = parseInt(pooldice) + 1;
                    socket.emit('increase dicepoolmax', i-1);
                }
                i = parseInt(i) - 1;
                socket.emit('update dicepool', {'field': field, 'index': i, 'value': v});
            });
        });
        function updateDicePool(n=1, value=0, max=7) {
            value = parseInt(value);
            value = value < 0 ? 0 : value;
            $('#dicepool' + n).html(value);
            $('#dicepool' + n).prop('title', value + ' / ' + max + ' (click to refresh dice pool to max)');
            $('#minusPoolDice' + n).prop('title', 'subtract when spending for your own roll or when helping');
            if (value < 1) {
                // lock "minus", unlock "plus", and "restore" button
                $('#plusPoolDice' + n).removeClass('locked');
                $('#minusPoolDice' + n).addClass('locked');
                $('#dicepool' + n).removeClass('locked');
            }
            else if (value < max) {
                // unlock "minus", "plus", and "restore" button
                $('#minusPoolDice' + n).removeClass('locked');
                $('#plusPoolDice' + n).removeClass('locked');
                $('#dicepool' + n).removeClass('locked');
            }
            else {
                // unlock "minus" button, lock "plus" and "restore" button
                $('#minusPoolDice' + n).removeClass('locked');
                $('#plusPoolDice' + n).addClass('locked');
                $('#dicepool' + n).addClass('locked');
            }
        }

        function updateXP(n=1, value=0) {
            value = parseInt(value);
            value = value < 0 ? 0 : value;
            $('#xp' + n).html(value);
            $('#xp' + n).prop('title', 'spend 5 XP to increase dice pool maximum and get 1 pool die?');
            if (value < 1) {
                $('#minusXP' + n).addClass('locked');
                $('#xp' + n).addClass('locked');
            }
            else if (value < 5) {
                $('#minusXP' + n).removeClass('locked');
                $('#xp' + n).addClass('locked');
            }
            else {
                $('#minusXP' + n).removeClass('locked');
                $('#xp' + n).removeClass('locked');
            }
        }
        $('[name=attributes] button').each(function() {
            $(this).click(function(e) {
                e.preventDefault();
                var field = $(this).prop('name');
                var i = $(this).prop('id');
                i = i.slice(-1); // last letter of index is the count number
                var $infoArea = $('#infoArea');
                var html = '';

                // display the hidden values in the info panel
                if (field == 'traitsButton') {
                    $infoArea.html($('#traits' + i).html());
                    showRules();
                }
                else if (field == 'keysButton') {
                    $infoArea.html($('#keys' + i).html());
                    showRules();
                }
                else if (field == 'secretsButton') {
                    $infoArea.html($('#secrets' + i).html());
                    showRules();
                }
            });
        });

        $('input[type=checkbox]').each(function() {
            $(this).on('change', function(e) {
                e.preventDefault();
                var field = $(this).prop('name');
                var v = $(this).prop('checked');
                var i = $(this).prop('id');
                i = i.slice(-1); // last letter of id is the count number
                i = parseInt(i) - 1;

                if (field == "needFuel" || field == "needSupplies" ||
                    field == "needRepairs" || field == "needSpeed") {
                    i = null;
                }
                socket.emit('update condition', {'index': i, 'condition': field, 'state': v});
            });
        });
        function updateOwlConditions(conditions) {
            let checkboxes = $('#owlconditions input[type=checkbox]');
            for (let j = 0; j < checkboxes.length; j++) {
                let c = $(checkboxes[j]).prop('name');
                if (conditions.indexOf(c) != -1) {
                    $(checkboxes[j]).prop('checked', true);
                }
                else {
                    $(checkboxes[j]).prop('checked', false);
                }
            }
        }

        $('select[name=role], input[name=player], input[name=character], textarea[name=notes], button[name=plusXP], button[name=minusXP]').each(function() {
            $(this).on('change', function(e) {
                e.preventDefault();
                let field = $(this).prop('name');
                let i = $(this).prop('id');
                let v = $(this).val();
                i = i.slice(-1); // last letter of index is the count number
                let xp = parseInt($('#xp' + i).html());

                if (field == 'role') {
                    // clear the infoarea
                    $('#infoArea').html(infotext['taglines']);
                }
                else if (field == 'plusXP') {
                    field = 'xp';
                    v = parseInt(xp) + 1;
                }
                else if (field == 'minusXP') {
                    field = 'xp';
                    v = parseInt(xp) - 1;
                }
                i = parseInt(i) - 1;
                //console.log('field ' + field + ' index ' + i + ' value ' + v);
                socket.emit('update field', {'field': field, 'index': i, 'value': v});
            });
        });
        $('button[name=plusXP], button[name=minusXP]').each(function() {
            $(this).click(function(e) {
                e.preventDefault();
                let field = $(this).prop('name');
                let i = $(this).prop('id');
                let v = $(this).val();
                i = i.slice(-1); // last letter of index is the count number
                let xp = parseInt($('#xp' + i).html());

                if (field == 'plusXP') {
                    field = 'xp';
                    v = parseInt(xp) + 1;
                }
                else if (field == 'minusXP') {
                    field = 'xp';
                    v = parseInt(xp) - 1;
                }
                i = parseInt(i) - 1;
                //console.log('field ' + field + ' index ' + i + ' value ' + v);
                socket.emit('update field', {'field': field, 'index': i, 'value': v});
            });
        });

        socket.on('update field', function(data) {
            var field = data.field;
            var number = data.number;
            var value = data.value;
            if (field == 'tired' || field == 'angry' || field == 'trapped' ||
                field == 'injured' || field == 'dead') {
                $('#' + field + number).prop('checked', value);
            }
            else if (field == 'needFuel' || field == 'needSupplies' ||
                     field == 'needRepairs' || field == 'needSpeed') {
                $('#' + field).prop('checked', value);
            }
            else {
                $('#' + field + number).val(value);

                if (field == 'xp') {
                    updateXP(number, value);
                }
            }
            save();
        });
        socket.on('update client', function(data) {
            let users = data.users;
            let info = data.info;
            let conditions;
            let p = info['profiles'];

            updateUserList(users);
            if (info['currentmap']) {
                updateImage('currentmap', info['currentmap']);
            }
            if (info['currentimage']) {
                updateImage('currentimage', info['currentimage']);
            }

            // owl conditions
            updateOwlConditions(info['owl']['conditions']);

            for (let i = 0; i < p.length; i++) {

                $('#role' + (i+1)).val(p[i]['role']);

                updatePortrait((i+1), p[i]['portrait']);

                $('#player' + (i+1)).val(p[i]['player']);
                $('#character' + (i+1)).val(p[i]['character']);
                $('#notes' + (i+1)).val(p[i]['notes']);
                updateDicePool((i+1), p[i]['dicepool'], p[i]['dicepoolmax']);
                updateXP((i+1), p[i]['xp']);

                updateTraits((i+1), p[i]['traits']);

                updateKeys((i+1), p[i]['keys']);

                updateSecrets((i+1), p[i]['secrets']);

                // character conditions
                conditions = $('#conditions' + (i+1) + ' input[type=checkbox]');
                for (let j = 0; j < conditions.length; j++) {
                    let c = $(conditions[j]).prop('name');
                    if (p[i]['conditions'].indexOf(c) != -1) {
                        $(conditions[j]).prop('checked', true);
                    }
                    else {
                        $(conditions[j]).prop('checked', false);
                    }
                }
                save();
            }
        });

        function buyTag(tag, trait, number) {
            if (parseInt($('#xp' + number).html()) > 2) {
                socket.emit('buy tag', {'tag': tag, 'trait': trait, 'index': (number-1)});
            }
            else {
                alert("you don't have enough xp to buy this tag");
            }
        }
        function buyTrait(number) {
            if (parseInt($('#xp' + number).html()) > 4) {
                var trait = prompt("type in the exact name of the new trait based on the \"advancements\" listing");
                trait = sanitize(trait, 'name').trim();
                if (trait) {
                    socket.emit('buy trait', {'trait': trait, 'index': (number-1)});
                }
            }
            else {
                alert("you don't have enough xp");
            }
        }
        function buyKey(number) {
            if (parseInt($('#xp' + number).html()) > 4) {
                var key = prompt("type in the exact name of the new key based on the \"advancements\" listing");
                key = sanitize(key, 'name').trim();
                if (key) {
                    socket.emit('buy key', {'key': key, 'index': (number-1)});
                }
            }
            else {
                alert("you don't have enough xp");
            }
        }
        function buySecret(number) {
            if (parseInt($('#xp' + number).html()) > 4) {
                var secret = prompt("type in the exact name of the new secret based on the \"advancements\" listing");
                secret = sanitize(secret, 'name').trim();
                if (secret) {
                    socket.emit('buy secret', {'secret': secret, 'index': (number-1)});
                }
            }
            else {
                alert("you don't have enough xp");
            }
        }
        function buyoffKey(key, number) {
            if (confirm("Buyoff this key to gain 5 XP, but you won't earn more XP from it. Is that okay?")) {
                socket.emit('buyoff key', {'key': key, 'index': (number-1)});
            }
        }

        socket.on('update traits', function(data) {
            var number = data.number;
            var traits = data.traits;
            updateTraits(number, traits);
            // refresh info area
            $('#infoArea').html($('#traits' + number).html());
        });
        function updateTraits(n=1, traits) {
            // traits put into a hidden area
            var html = '<div class="traits">';
            for (var t in traits) {
                html += '<strong>' + t + '</strong>';
                html += '<div class="indented tags">';
                var item, tag = '';
                var list = [];
                for (var j = 0; j < traits[t].length; j++) {
                    tag = traits[t][j];
                    // make bracketed tags a "link" to buy such tag
                    if (tag.substring(0, 1) == '[') {
                        item = '<div class="btn btn-sm btn-link" title="click to buy with 3 XP" onclick="buyTag(\'' + tag + '\', \'' + t + '\', ' + n + ')">' + tag + '</div>';
                    }
                    else {
                        item = tag;
                    }
                    list.push(item);
                }
                html += list.join(', ');
                html += '</div>';
            }
            html += '<div class="text-muted"><small>A bracketed tag will cost 3 XP.</small></div>';
            html += '<div class="btn btn-sm btn-link" onclick="buyTrait(' + n + ')">buy a new Trait?</div>';
            html += '</div>';
            $('#traits' + n).html(html);
        }

        socket.on('update keys', function(data) {
            var number = data.number;
            var keys = data.keys;
            updateKeys(number, keys);
            // refresh info area
            $('#infoArea').html($('#keys' + number).html());
        });
        function updateKeys(n=1, keys) {
            var html = '<div class="keys">';
            // keys put into a hidden area
            for (var k in keys) {
                html += '<strong>' + k + '</strong>';
                var str = keys[k];
                var i = str.indexOf('BUYOFF:');
                if (i != -1) {
                    var parts = str.split("BUYOFF:");
                    str = parts[0] + '<div class="btn btn-sm btn-link" title="when condition is met, click to buyoff this key to gain 5 XP" onclick="buyoffKey(' + '\'' + k + '\', ' + n + ')">BUYOFF</div>:' + parts[1];
                }
                html += '<div class="indented">' + str + '</div>';
            }
            html += '<div class="btn btn-sm btn-link" onclick="buyKey(' + n + ')">buy a new Key?</div>';
            html += '</div>';
            $('#keys' + n).html(html);
        }

        socket.on('update secrets', function(data) {
            var number = data.number;
            var secrets = data.secrets;
            updateSecrets(number, secrets);
            // refresh info area
            $('#infoArea').html($('#secrets' + number).html());
        });
        function updateSecrets(n=1, secrets) {
            var html = '<div class="secrets">';
            // secrets put into a hidden area
            for (var s in secrets) {
                html += '<strong>' + s + '</strong>';
                html += '<div class="indented">' + secrets[s] + '</div>';
            }
            html += '<div class="btn btn-sm btn-link" onclick="buySecret(' + n + ')">buy a new Secret?</div>';
            html += '</div>';
            $('#secrets' + n).html(html);
        }

        function clearHiddenFields() {
            $('[name=traits], [name=keys], [name=secrets]').each(function() {
                $(this).html('');
            });
        }

        function safetyTool(type='x-card') {
            if (type == 'x-card') { // x-card
                var msg = prompt("What content to remove? Click OK to send the notice regardless.");
                if (msg !== null) {
                    socket.emit('x-card', msg);
                }
            }
            else if (type == 'raisedhand') {
                socket.emit('handgesture', type);
            }
            else if (type == 'thumbup') {
                socket.emit('handgesture', type);
            }
        }
        socket.on('x-card', function(data) {
            var html = '<div class="text-danger"><strong>X-Card</strong> used, ';
            if (data) {
                html += 'please remove "' + data + '"';
            }
            else {
                html += 'ask for clarification if needed';
            }
            html += '</div>';
            updateChat(html);
        });
        socket.on('handgesture', function(data) {
            var user = data.user;
            var type = data.type;
            var html = '';
            if (type == 'raisedhand') {
                html = '<div class="text-success"><strong>' + user + '</strong> wants to speak</div>';
            }
            else if (type =='thumbup') {
                html = '<div class="text-success"><strong>' + user + '</strong>: <img src="https://raw.githubusercontent.com/brushmen/trpgplayaid_server/master/icons/thumbup.png" class="icon-md" alt="thumbups up"></div>';
            }
            updateChat(html);
        });

        // infoarea related

        $('#infolist').on('change', function() {
            // only update locally
            var $infolist = $('#infolist');
            var $infoArea = $('#infoArea');
            $infoArea.html(infotext[$infolist.val()]);
        });

        function save() {
            // save the game on the server
            socket.emit('save');
        }

        function saveGame() {
            // download a JSON copy
            socket.emit('save game');
        }
        socket.on('save game', function(data) {
            var filename = gamehandle + '_' + room + '_' + getTodayString() + '.json';
            // generate the file to download locally
            download(filename, data);
        });

        function newGame() {
            if(confirm('Start over?')) {
                // clear hidden data
                clearHiddenFields();
                $('#infoArea').html(infotext['theworlds']);
                socket.emit('new game');
            }
        }

        // whiteboard area, new p5 instance

        const sketchpad = ( sketch ) => {

            let color = '#000';
            let stroke = 2;
            let buttonlist = ['erase-btn', 'black-btn','red-btn','green-btn','blue-btn','brown-btn'];
            let pg; // graphics buffer

            sketch.setup = function() {
                var canvasDiv = document.getElementById('whiteboard');
                var width = canvasDiv.offsetWidth;
                var height = canvasDiv.offsetHeight;
                sketch.createCanvas(width, height);
                pg = sketch.createGraphics(width, height); // graphics buffer
                sketch.background(220, 217, 205);
                pg.background(220, 217, 205); // graphics buffer
            };

            $('#clear-btn, #erase-btn, #black-btn, #red-btn, #green-btn, #blue-btn, #brown-btn').each(function() {
                $(this).click(function(e) {
                    e.preventDefault();

                    if ($(this).prop('id') == 'clear-btn') {
                        if (confirm("This will clear the scratchpad for all users here. Proceed?")) {
                            sketch.background("rgb(220, 217, 205)");
                            pg.background("rgb(220, 217, 205)"); // graphics buffer
                            stroke = 2;
                            var data = {
                                'background': 'rgb(220, 217, 205)'
                            };
                            socket.emit('sketchpad', {'action': 'clear', 'params': data});
                        }
                    }
                    else if ($(this).prop('id') == 'erase-btn') {
                        color = "rgb(220, 217, 205)";
                        stroke = 10;
                    }
                    else if ($(this).prop('id') == 'black-btn') {
                        color = "rgb(0, 0, 0)";
                        stroke = 2;
                    }
                    else if ($(this).prop('id') == 'red-btn') {
                        color = "rgb(204, 0, 0)";
                        stroke = 2;
                    }
                    else if ($(this).prop('id') == 'green-btn') {
                        color = "rgb(0, 153, 51)";
                        stroke = 2;
                    }
                    else if ($(this).prop('id') == 'blue-btn') {
                        color = "rgb(0, 102, 255)";
                        stroke = 2;
                    }
                    else if ($(this).prop('id') == 'brown-btn') {
                        color = "rgb(134, 89, 45)";
                        stroke = 2;
                    }
                    highlightColor($(this).prop('id'), buttonlist);

                    function highlightColor(selected, list) {
                        for (var c in list) {
                            if (list[c] == selected) {
                                $('#' + list[c]).addClass('selected');
                            }
                            else {
                                $('#' + list[c]).removeClass('selected');
                            }
                        }
                    }
                });
            });

            sketch.mouseDragged = function() {
                sketch.noStroke();
                sketch.stroke(color);
                pg.stroke(color); // graphics buffer
                sketch.strokeWeight(stroke);
                pg.strokeWeight(stroke); // graphics buffer
                sketch.line(sketch.mouseX, sketch.mouseY, sketch.pmouseX, sketch.pmouseY);
                pg.line(sketch.mouseX, sketch.mouseY, sketch.pmouseX, sketch.pmouseY); // graphics buffer

                var data = {
                    'mouseX': sketch.mouseX,
                    'mouseY': sketch.mouseY,
                    'pmouseX': sketch.pmouseX,
                    'pmouseY': sketch.pmouseY,
                    'color': color,
                    'stroke': stroke
                };
                socket.emit('sketchpad', {'action': 'draw line', 'params': data});
            };

            socket.on('sketchpad', function(data) {
                var action = data.action;
                var params = data.params;

                if (action == 'draw line') {
                    sketch.noStroke();
                    sketch.stroke(params.color);
                    pg.stroke(params.color); // graphics buffer
                    sketch.strokeWeight(params.stroke);
                    pg.strokeWeight(params.stroke); // graphics buffer
                    sketch.line(params.mouseX, params.mouseY, params.pmouseX, params.pmouseY);
                    pg.line(params.mouseX, params.mouseY, params.pmouseX, params.pmouseY); // graphics buffer
                }
                else if (action == 'clear') {
                    sketch.background(params.background);
                    pg.background(params.background); // graphics buffer
                }
            });

            sketch.windowResized = function () {
                //sketch.centerCanvas();
                var canvasDiv = document.getElementById('whiteboard');
                var width = canvasDiv.clientWidth;
                var height = canvasDiv.clientHeight;
                sketch.resizeCanvas(width, height);
                sketch.image(pg, 0, 0); // redraw onto canvas from the buffer
            };
        };
        let myp5 = new p5(sketchpad, 'whiteboard');

        function toggleScratchpad() {
            if ( $('#scratchpadArea').css('visibility') == 'hidden' ) {
                $('#scratchpadArea').css('visibility','visible');
            }
            else {
                $('#scratchpadArea').css('visibility','hidden');
            }
        }
    </script>
</body>
</html>
